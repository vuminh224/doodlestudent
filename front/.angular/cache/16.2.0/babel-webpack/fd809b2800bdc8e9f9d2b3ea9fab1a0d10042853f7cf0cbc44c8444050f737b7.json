{"ast":null,"code":"import { MessageService } from 'primeng/api';\nimport { PollService } from '../poll-service.service';\nimport { FullCalendarComponent } from '@fullcalendar/angular';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"primeng/api\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../poll-service.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"primeng/toast\";\nimport * as i7 from \"primeng/card\";\nimport * as i8 from \"primeng/button\";\nimport * as i9 from \"primeng/inputtext\";\nimport * as i10 from \"primeng/checkbox\";\nimport * as i11 from \"../top-bar/top-bar.component\";\nimport * as i12 from \"../show-comments/show-comments.component\";\nimport * as i13 from \"../dateago.pipe\";\nimport * as i14 from \"../username-pipe.pipe\";\nimport * as i15 from \"../selecteddate4user-pipe.pipe\";\nfunction AdminPollComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h1\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.poll == null ? null : ctx_r0.poll.title);\n  }\n}\nfunction AdminPollComponent_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"dateago\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Cr\\u00E9\\u00E9 il y a \", i0.ɵɵpipeBind1(3, 1, ctx_r1.poll == null ? null : ctx_r1.poll.createdAt), \"\");\n  }\n}\nfunction AdminPollComponent_ng_template_7_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 23);\n    i0.ɵɵelement(2, \"path\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Cet \\u00E9v\\u00E8nement contient un repas \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AdminPollComponent_ng_template_7_th_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ev_r11 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(2, 1, ev_r11.start, \"EEEE d LLLL\", \"CEST\", \"fr\"));\n  }\n}\nfunction AdminPollComponent_ng_template_7_th_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelement(3, \"BR\");\n    i0.ɵɵtext(4, \"-\");\n    i0.ɵɵelement(5, \"BR\");\n    i0.ɵɵtext(6);\n    i0.ɵɵpipe(7, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ev_r12 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(2, 2, ev_r12.start, \"H:mm\"), \" \");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(7, 5, ev_r12.end, \"H:mm\"), \"\");\n  }\n}\nfunction AdminPollComponent_ng_template_7_span_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"s\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AdminPollComponent_ng_template_7_th_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const pc_r13 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(pc_r13.users.length);\n  }\n}\nfunction AdminPollComponent_ng_template_7_tr_26_td_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 26);\n    i0.ɵɵelement(1, \"p-checkbox\", 28);\n    i0.ɵɵpipe(2, \"selecteddate4userPipe\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ev_r16 = ctx.$implicit;\n    const u_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", true)(\"binary\", true)(\"ngModel\", i0.ɵɵpipeBind3(2, 3, u_r14.value, u_r14.key, ev_r16));\n  }\n}\nfunction AdminPollComponent_ng_template_7_tr_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵelement(2, \"input\", 27);\n    i0.ɵɵpipe(3, \"usernamePipe\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, AdminPollComponent_ng_template_7_tr_26_td_4_Template, 3, 7, \"td\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const u_r14 = ctx.$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", true)(\"ngModel\", i0.ɵɵpipeBind2(3, 3, ctx_r9.uniqueUsers, u_r14.key));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r9.events);\n  }\n}\nfunction AdminPollComponent_ng_template_7_td_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"td\", 26)(1, \"p-button\", 29);\n    i0.ɵɵlistener(\"onClick\", function AdminPollComponent_ng_template_7_td_30_Template_p_button_onClick_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r20);\n      const ev_r18 = restoredCtx.$implicit;\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r19.selectEvent($event, ev_r18));\n    });\n    i0.ɵɵtext(2, \"s\\u00E9lectionner cette date\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r10.poll == null ? null : ctx_r10.poll.clos);\n  }\n}\nfunction AdminPollComponent_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"p\", 9);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(2, \"svg\", 10);\n    i0.ɵɵelement(3, \"path\", 11)(4, \"circle\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, AdminPollComponent_ng_template_7_div_6_Template, 4, 0, \"div\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(7, \"div\")(8, \"div\");\n    i0.ɵɵtext(9, \" \\u00A0\\u00A0\\u00A0\\u00A0\\u00A0\\u00A0\");\n    i0.ɵɵelementStart(10, \"div\", 14)(11, \"div\", 15)(12, \"table\", 16)(13, \"thead\")(14, \"tr\");\n    i0.ɵɵelement(15, \"th\", 17);\n    i0.ɵɵtemplate(16, AdminPollComponent_ng_template_7_th_16_Template, 3, 6, \"th\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"tr\");\n    i0.ɵɵtemplate(18, AdminPollComponent_ng_template_7_th_18_Template, 8, 8, \"th\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"tr\")(20, \"th\")(21, \"span\");\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(23, AdminPollComponent_ng_template_7_span_23_Template, 2, 0, \"span\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(24, AdminPollComponent_ng_template_7_th_24_Template, 2, 1, \"th\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(25, \"tbody\");\n    i0.ɵɵtemplate(26, AdminPollComponent_ng_template_7_tr_26_Template, 5, 6, \"tr\", 21);\n    i0.ɵɵpipe(27, \"keyvalue\");\n    i0.ɵɵelementStart(28, \"tr\");\n    i0.ɵɵelement(29, \"td\");\n    i0.ɵɵtemplate(30, AdminPollComponent_ng_template_7_td_30_Template, 3, 1, \"td\", 19);\n    i0.ɵɵelementEnd()()()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r2.poll == null ? null : ctx_r2.poll.location);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.poll == null ? null : ctx_r2.poll.has_meal);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.events);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.events);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.uniqueUsers.length, \" participant\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.uniqueUsers.length > 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.poll == null ? null : ctx_r2.poll.pollChoices);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(27, 9, ctx_r2.userChoices));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.events);\n  }\n}\nfunction AdminPollComponent_ng_template_8_app_show_comments_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-show-comments\", 31);\n  }\n  if (rf & 2) {\n    const ctx_r21 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"comments\", ctx_r21.comments);\n  }\n}\nfunction AdminPollComponent_ng_template_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, AdminPollComponent_ng_template_8_app_show_comments_0_Template, 1, 1, \"app-show-comments\", 30);\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.poll);\n  }\n}\nconst _c0 = function () {\n  return {\n    \"marginBottom\": \"1rem\"\n  };\n};\nexport let AdminPollComponent = /*#__PURE__*/(() => {\n  var _class;\n  class AdminPollComponent {\n    constructor(messageService, actRoute, pollService) {\n      this.messageService = messageService;\n      this.actRoute = actRoute;\n      this.pollService = pollService;\n      this.events = [];\n      this.uniqueUsers = [];\n      this.userChoices = new Map();\n    }\n    ngOnInit() {\n      this.actRoute.paramMap.subscribe(params => {\n        this.slugid = params.get('slugadminid');\n        this.pollService.getPollBySlugAdminId(this.slugid).subscribe(p => {\n          this.poll = p;\n          if (p != null) {\n            this.pollService.getComentsBySlugId(this.poll?.slug).subscribe(cs => this.comments = cs);\n          }\n          this.uniqueUsers.splice(0, this.uniqueUsers.length);\n          this.poll.pollChoices.forEach(pc => {\n            pc.users.forEach(user => {\n              if (this.uniqueUsers.filter(us => us.id === user.id).length === 0) {\n                this.uniqueUsers.push(user);\n                this.userChoices.set(user.id, []);\n              }\n            });\n            const evt = {\n              title: '',\n              start: pc.startDate,\n              end: pc.endDate,\n              resourceEditable: false,\n              eventResizableFromStart: false,\n              backgroundColor: 'red',\n              extendedProps: {\n                choiceid: pc.id,\n                selected: false\n              }\n            };\n            this.events.push(evt);\n          });\n          this.poll.pollChoices.forEach(pc => {\n            pc.users.forEach(us => {\n              this.userChoices.get(us.id).push(pc);\n            });\n          });\n        });\n      });\n    }\n    selectEvent($event, event) {\n      this.pollService.selectEvent(event.extendedProps.choiceid).subscribe(e => {\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Données enregistrées',\n          detail: 'Le sondage est maintenant close'\n        });\n        this.poll.clos = true;\n      }, error => {\n        this.messageService.add({\n          severity: 'warn',\n          summary: 'Sélection de cette date impossible',\n          detail: 'Le sondage n\\'a pu être clos'\n        });\n      });\n      return;\n    }\n  }\n  _class = AdminPollComponent;\n  _class.ɵfac = function AdminPollComponent_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.MessageService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.PollService));\n  };\n  _class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"app-admin-poll\"]],\n    features: [i0.ɵɵProvidersFeature([MessageService, PollService, FullCalendarComponent])],\n    decls: 9,\n    vars: 6,\n    consts: [[1, \"Container\"], [\"src\", \"assets/flat_logo.png\", \"alt\", \"Logo Simba\", \"height\", \"50px\", 3, \"ngStyle\"], [3, \"adminSlug\", \"slug\", \"padURL\", \"talkToURL\"], [\"pTemplate\", \"title\"], [\"pTemplate\", \"subtitle\"], [\"pTemplate\", \"content\"], [\"pTemplate\", \"footer\"], [1, \"Dates\"], [1, \"Poll_Infos\"], [1, \"Poll_Location\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"width\", \"20\", \"height\", \"20\", \"viewBox\", \"0 0 24 24\", \"fill\", \"none\", \"stroke\", \"currentColor\", \"stroke-width\", \"2\", \"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", 1, \"feather\", \"feather-map-pin\"], [\"d\", \"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"], [\"cx\", \"12\", \"cy\", \"10\", \"r\", \"3\"], [\"class\", \"Poll_Has_Meal\", 4, \"ngIf\"], [1, \"container-fluid\"], [1, \"table-responsive-sm\", \"card\"], [1, \"table\"], [\"rowspan\", \"2\"], [\"class\", \"text-light\", \"style\", \"text-align: center;background-color: #545B62\", 4, \"ngFor\", \"ngForOf\"], [\"style\", \"text-align: center\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [1, \"Poll_Has_Meal\"], [\"aria-hidden\", \"true\", \"width\", \"20\", \"height\", \"20\", \"focusable\", \"false\", \"data-prefix\", \"fas\", \"data-icon\", \"utensils\", \"role\", \"img\", \"xmlns\", \"http://www.w3.org/2000/svg\", \"viewBox\", \"0 0 416 512\", 1, \"feather\"], [\"fill\", \"currentColor\", \"d\", \"M207.9 15.2c.8 4.7 16.1 94.5 16.1 128.8 0 52.3-27.8 89.6-68.9 104.6L168 486.7c.7 13.7-10.2 25.3-24 25.3H80c-13.7 0-24.7-11.5-24-25.3l12.9-238.1C27.7 233.6 0 196.2 0 144 0 109.6 15.3 19.9 16.1 15.2 19.3-5.1 61.4-5.4 64 16.3v141.2c1.3 3.4 15.1 3.2 16 0 1.4-25.3 7.9-139.2 8-141.8 3.3-20.8 44.7-20.8 47.9 0 .2 2.7 6.6 116.5 8 141.8.9 3.2 14.8 3.4 16 0V16.3c2.6-21.6 44.8-21.4 48-1.1zm119.2 285.7l-15 185.1c-1.2 14 9.9 26 23.9 26h56c13.3 0 24-10.7 24-24V24c0-13.2-10.7-24-24-24-82.5 0-221.4 178.5-64.9 300.9z\"], [1, \"text-light\", 2, \"text-align\", \"center\", \"background-color\", \"#545B62\"], [2, \"text-align\", \"center\"], [\"type\", \"text\", \"pInputText\", \"\", 3, \"disabled\", \"ngModel\"], [3, \"disabled\", \"binary\", \"ngModel\"], [3, \"disabled\", \"onClick\"], [3, \"comments\", 4, \"ngIf\"], [3, \"comments\"]],\n    template: function AdminPollComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelement(1, \"img\", 1)(2, \"app-top-bar\", 2);\n        i0.ɵɵelementStart(3, \"p-card\");\n        i0.ɵɵelement(4, \"p-toast\");\n        i0.ɵɵtemplate(5, AdminPollComponent_ng_template_5_Template, 2, 1, \"ng-template\", 3);\n        i0.ɵɵtemplate(6, AdminPollComponent_ng_template_6_Template, 4, 3, \"ng-template\", 4);\n        i0.ɵɵtemplate(7, AdminPollComponent_ng_template_7_Template, 31, 11, \"ng-template\", 5);\n        i0.ɵɵtemplate(8, AdminPollComponent_ng_template_8_Template, 1, 1, \"ng-template\", 6);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngStyle\", i0.ɵɵpureFunction0(5, _c0));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"adminSlug\", ctx.poll == null ? null : ctx.poll.slugAdmin)(\"slug\", ctx.poll == null ? null : ctx.poll.slug)(\"padURL\", ctx.poll == null ? null : ctx.poll.padURL)(\"talkToURL\", ctx.poll == null ? null : ctx.poll.tlkURL);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i4.NgStyle, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgModel, i6.Toast, i1.PrimeTemplate, i7.Card, i8.Button, i9.InputText, i10.Checkbox, i11.TopBarComponent, i12.ShowCommentsComponent, i4.DatePipe, i4.KeyValuePipe, i13.DateagoPipe, i14.UsernamePipePipe, i15.Selecteddate4userPipePipe],\n    styles: [\".Poll_Informations[_ngcontent-%COMP%]{background-color:#fff;width:100%;margin-top:1rem;box-shadow:0 2px 4px #0000001a;border-radius:5px}.Meal_Preferences[_ngcontent-%COMP%]{padding:1rem;border-bottom:2px solid #F0F4F8}.Poll_Has_Meal[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex:1}.Poll_Has_Meal[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.Poll_Description_Title[_ngcontent-%COMP%]{font-size:.8rem;color:#243b53}.Poll_Infos[_ngcontent-%COMP%]{display:flex}.Poll_Info[_ngcontent-%COMP%]{flex:1}\"]\n  });\n  return AdminPollComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}